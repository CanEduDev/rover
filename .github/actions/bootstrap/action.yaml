name: Bootstrap Repository
description: Bootstrap the Rover repository with caching and environment setup

runs:
  using: composite
  steps:

    - name: Cache tools dir
      uses: actions/cache@v4
      with:
        path: .tools
        key: tools-${{ runner.os }}-${{ hashFiles('scripts/bootstrap.sh') }}

    - name: Cache python venv
      uses: actions/cache@v4
      with:
        path: .venv
        key: venv-${{ runner.os }}-${{ hashFiles('uv.lock') }}

    - name: Cache meson subprojects
      uses: actions/cache@v4
      with:
        path: subprojects
        key: meson-${{ runner.os }}-${{ hashFiles('subprojects/*.wrap') }}-${{ hashFiles('subprojects/packagefiles/**') }}

    - name: Bootstrap build
      run: ./scripts/bootstrap.sh
      shell: bash

    - name: Activate python venv
      run: |
        source .venv/bin/activate
        echo "$VIRTUAL_ENV/bin" >> $GITHUB_PATH
        echo "VIRTUAL_ENV=$VIRTUAL_ENV" >> $GITHUB_ENV
      shell: bash
